# 第4回 変数とメモリ

- [第4回 変数とメモリ](#第4回-変数とメモリ)
  - [Rの付値操作](#rの付値操作)
  - [箱型言語](#箱型言語)
  - [ラベル型言語](#ラベル型言語)

## Rの付値操作

本講義の受講者にとって、Rの次のような操作は至極ありふれたものだと思います。

```R
# コード1
x <- c(1,2,3)
y <- x
x[2] <- 5
print(x)
print(y)
```

上記のコマンドを実行したときに、どのような結果が出力されるかを答えられない人はいないでしょう。実際にRの対話的インタープリタを起動するか、VS Code上で実行してみれば良いでしょう。

```R
> print(x)
[1] 1 5 3
> print(y)
[1] 1 2 3
> 
```

しかし、コード1で実際に何が起きているのかを正しく説明できる人はほとんどいないのではないかと思います（できたら素晴らしい！）。

多くの人が次のように考えているのではないでしょうか？

1. 変数xにベクトル(1,2,3)が代入される
2. 変数yに変数xの値、つまり(1,2,3)がコピーされる
3. 変数xの第2要素が5に書き換えられる
4. 変数xの値が出力される
5. 変数yの値が出力される

しかし、実際には、**上記のようなことは起きていません**。これを今日は理解して欲しいと思います。これを理解できるかどうかが、Pythonを理解する鍵であり、もっというなら、Pythonを含む様々な**動的型付け言語**を理解する鍵となります。

## 箱型言語

どのように間違っているかを説明する前に、なぜ上記のような間違いを犯しがちであるのかを説明しましょう。間違いの理由は、初学者向けにありがちな、「箱の比喩」を用いた代入の説明にあるものと思われます。

箱を用いた説明とは、次のようなものです。

>下図のように、変数xに1を代入するということは、xという箱に1という値を入れることであり、yにxを代入するということは、xに入っている値1をコピーしてyという箱に入れることである。

![box-type substitution](img/box_explanation.drawio.png)

このような説明は、C言語のようなプログラミング言語では正しい比喩ですが、RやPythonではミスリーディングです。Pythonでは特にミスリーディングであるだけでなく完全に間違いであり、害悪ですらあります。

## ラベル型言語

では、Rでは何が起きているのでしょうか。正しい比喩は以下のようなものです。

>下図のように、変数xに1を代入するということは、1という**モノ**(**オブジェクト**)にxというラベルを貼り付けることであり、変数yにxを代入するという操作は、ラベルxがついているオブジェクトにもう一つyという別のラベルを貼り付けることである。

![label-type substitution](img/label_explanation.drawio.png)

この正しい見方では、1という一つのオブジェクトにx、yという二つのラベルが貼り付けられています。

それでは、Rでの付値操作(y <- x)がこのような「ラベル張り」であるということを確かめてみましょう。